<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title>Report Incident</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <form [formGroup]="incidentForm" (ngSubmit)="submitIncident()">
    <div class="ion-padding">
      <ion-card>
        <ion-card-header>
          <ion-card-title>Incident Details</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-item>
            <ion-label position="stacked">Incident Type *</ion-label>
            <ion-select formControlName="type" placeholder="Select incident type">
              <ion-select-option value="burglary">Burglary</ion-select-option>
              <ion-select-option value="vandalism">Vandalism</ion-select-option>
              <ion-select-option value="suspicious_activity">Suspicious Activity</ion-select-option>
              <ion-select-option value="noise_complaint">Noise Complaint</ion-select-option>
              <ion-select-option value="trespassing">Trespassing</ion-select-option>
              <ion-select-option value="vehicle_break_in">Vehicle Break-in</ion-select-option>
              <ion-select-option value="property_damage">Property Damage</ion-select-option>
              <ion-select-option value="power_outage">Power Outage</ion-select-option>
              <ion-select-option value="water_leak">Water Leak</ion-select-option>
              <ion-select-option value="medical_incident">Medical Incident</ion-select-option>
              <ion-select-option value="fire_incident">Fire Incident</ion-select-option>
              <ion-select-option value="animal_incident">Animal Incident</ion-select-option>
              <ion-select-option value="neighborhood_watch">Neighborhood Watch</ion-select-option>
              <ion-select-option value="other">Other</ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item>
            <ion-label position="stacked">Severity Level *</ion-label>
            <ion-select formControlName="severity" placeholder="Select severity">
              <ion-select-option value="low">Low</ion-select-option>
              <ion-select-option value="medium">Medium</ion-select-option>
              <ion-select-option value="high">High</ion-select-option>
              <ion-select-option value="critical">Critical</ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item>
            <ion-label position="stacked">Title *</ion-label>
            <ion-input formControlName="title" placeholder="Brief description of the incident"></ion-input>
          </ion-item>

          <ion-item>
            <ion-label position="stacked">Description *</ion-label>
            <ion-textarea 
              formControlName="description" 
              placeholder="Provide detailed description of what happened"
              rows="4">
            </ion-textarea>
          </ion-item>

          <ion-item>
            <ion-label position="stacked">Address</ion-label>
            <ion-input formControlName="address" placeholder="Incident location address"></ion-input>
          </ion-item>

          <ion-item>
            <ion-label position="stacked">Tags</ion-label>
            <ion-input formControlName="tags" placeholder="Add tags separated by commas"></ion-input>
          </ion-item>

          <ion-item>
            <ion-checkbox formControlName="isPublic"></ion-checkbox>
            <ion-label>Make this incident public to community</ion-label>
          </ion-item>

          <ion-item>
            <ion-checkbox formControlName="followUpRequired"></ion-checkbox>
            <ion-label>Follow-up required</ion-label>
          </ion-item>
        </ion-card-content>
      </ion-card>

      <ion-card>
        <ion-card-header>
          <ion-card-title>Location</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-button expand="block" (click)="getCurrentLocation()" [disabled]="isGettingLocation">
            <ion-icon name="location" slot="start"></ion-icon>
            {{ isGettingLocation ? 'Getting Location...' : 'Use Current Location' }}
          </ion-button>
          
          <div *ngIf="currentLocation" class="location-info">
            <ion-text color="success">
              <p>Location captured: {{ currentLocation.latitude | number:'1.6-6' }}, {{ currentLocation.longitude | number:'1.6-6' }}</p>
            </ion-text>
          </div>
        </ion-card-content>
      </ion-card>

      <ion-card>
        <ion-card-header>
          <ion-card-title>Media Evidence</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-button expand="block" (click)="takePhoto()">
            <ion-icon name="camera" slot="start"></ion-icon>
            Take Photo
          </ion-button>
          
          <ion-button expand="block" (click)="recordVideo()" [disabled]="isRecording">
            <ion-icon name="videocam" slot="start"></ion-icon>
            {{ isRecording ? 'Recording...' : 'Record Video' }}
          </ion-button>

          <div *ngIf="photos.length > 0 || videos.length > 0" class="media-preview">
            <h4>Attached Media:</h4>
            <div class="media-grid">
              <div *ngFor="let photo of photos; let i = index" class="media-item">
                <img [src]="photo" alt="Photo">
                <ion-button fill="clear" size="small" (click)="removePhoto(i)">
                  <ion-icon name="close"></ion-icon>
                </ion-button>
              </div>
              <div *ngFor="let video of videos; let i = index" class="media-item">
                <video [src]="video" controls></video>
                <ion-button fill="clear" size="small" (click)="removeVideo(i)">
                  <ion-icon name="close"></ion-icon>
                </ion-button>
              </div>
            </div>
          </div>
        </ion-card-content>
      </ion-card>

      <ion-button 
        expand="block" 
        type="submit" 
        [disabled]="!incidentForm.valid || isSubmitting"
        class="submit-button">
        <ion-icon name="send" slot="start"></ion-icon>
        {{ isSubmitting ? 'Submitting...' : 'Report Incident' }}
      </ion-button>
    </div>
  </form>
</ion-content>
